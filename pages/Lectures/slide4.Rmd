---
title: "Эконометрикс II"
subtitle: "Лекц 5: Улиралын нөлөөг загварчлах, таамаглах <html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>"
author: "багш: Д. Хашбаатар"
date: "2019/09/18"
output: 
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    nature: 
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

# Улиралын нөлөөг загварчлах

--
Хугацаан цуваа
$$y_t=Trend_t + \color{red}{Seasonal}_t + Ciclyc_t + \varepsilon_t$$
--
Улиралын нөлөөтэй цуваа
$$y_t=S_t + \varepsilon_t$$
--
 
**Урьдчилан мэдэгдэх улиралын нөлөө** (perfectly predictable seasonality)

**Улиралын тоо** $s$ 
   - улиралын өгөгдөл (quarterly) 4
   - сарын өгөгдөл (monthly) 12
   - 7 хоногийн өгөгдөл (weekly) 52

---
# Улиралын дамми хувьсагч

дамми хувьсагч

$$D_s=\begin{cases}1,& \text{if observation is in s-th season} \\
                   0,& \text{else }\end{cases}$$

$s=4$ үед

| t 	| Date       	| $D_1$ 	| $D_2$ 	| $D_3$ 	| $D_4$ 	|
|---	|------------	|-------	|-------	|-------	|-------	|
| 1 	| 2001.01.01 	| 1     	| 0     	| 0     	| 0     	|
| 2 	| 2001.04.01 	| 0     	| 1     	| 0     	| 0     	|
| 3 	| 2001.07.01 	| 0     	| 0     	| 1     	| 0     	|
| 4 	| 2001.10.01 	| 0     	| 0     	| 0     	| 1     	|
| 5 	| 2002.01.01 	| 1     	| 0     	| 0     	| 0     	|

---
# Seasonal Component

Seasonal Component

$$S_t=\sum_{i=1}^s\gamma_{i}D_{it},\quad t=1,\ldots,T$$
 
 - $s=4$ үед
$$S_t=\gamma_1D_{1t}+\gamma_2D_{2t}+\gamma_3D_{3t}+\gamma_4D_{4t}.$$

 - $\gamma_i$ коэффициентүүдийг улиралын фактор (seasonal factor) гэдэг
 - *хуанлийн нөлөөг* оруулах боломжтой (баяр ёслолын өдөр, амралтын өдөр гэх мэт)
 
Улиралын нөлөө бүxий цуваа
$$\color{red}{y_t=\sum_{i=1}^s\gamma_{i}D_{it}+\varepsilon_t,\quad t=1,\ldots,T}$$
---
# Үнэлгээ болон таамаглал

 1. Улиралын дамми бүxий шугаман регрессийг үнэлнэ
$$\hat y_t=\sum_{i=1}^s\hat\gamma_{i}D_{it}$$ 
 2. Ирээдүйн $T+h$ цэгт хугацаан цувааны утгыг таамаглана
 


|                                                    <font color="red">Цэгэн таамаглал</font> 	|                                 <font color="blue">Интервал таамаглал</font> 	|                               Нягтын таамаглал 	|
|------------------------------------------------------------------:	|--------------------------------------------------:	|-----------------------------------------------:	|
| $$\color{red}{\hat{y}_{T+h,T} =\sum_{i=1}^s\hat\gamma_{i}D_{i,T+h}}$$ 	| $$\color{blue}{\hat{y}_{T+h,T}\pm 1.96\hat\sigma_\varepsilon}$$ 	| $$N(\hat{y}_{T+h,T}, \hat\sigma_\varepsilon)$$ 	|
|
 
---
# Хэрэглээ: Шинээр баригдаж буй орон сууц


|date       | hstarts|
|:----------|-------:|
|1946-01-01 |      57|
|1946-02-01 |      65|
|1946-03-01 |      95|
|1946-04-01 |     103|
|1946-05-01 |     103|
|1946-06-01 |      97|
|1946-07-01 |      94|
|1946-08-01 |      96|
Table: Сар бүр шинээр баригдаж буй орон сууцын тоо: 1946-1994
```{r message=FALSE, echo=FALSE}
load("ch6data.Rdata")
library(dplyr)
housing <- ch6data %>% 
  select(date, hstarts, seasonal) %>% 
  filter(date >= as.Date("1946-01-01") & date <= as.Date("1994-11-01"))

```

---
```{r message=FALSE,fig.fullwidth=TRUE, fig.align='center', fig.width = 11,fig.height=7}
plot(housing$date, housing$hstarts, type = "l", ylab="Starts", xlab = "Time", lwd = 2)
```
---
# Үнэлгээ

```{r echo=FALSE, message=FALSE,fig.fullwidth=TRUE, fig.align='center', fig.width = 11,fig.height=7}
estimation_data <- housing[1:576,]
evaluation_data <- housing[-1:-576,]
res1 <- lm(hstarts ~ seasonal - 1, data = estimation_data)
```
|term       |  estimate| std.error| statistic| p.value|
|:----------|---------:|---------:|---------:|-------:|
|seasonal1  |  86.50417|  4.029055|  21.47009|       0|
|seasonal2  |  89.50417|  4.029055|  22.21468|       0|
|seasonal3  | 122.88333|  4.029055|  30.49929|       0|
|seasonal4  | 142.16875|  4.029055|  35.28588|       0|
|seasonal5  | 147.50000|  4.029055|  36.60908|       0|
|seasonal6  | 145.99792|  4.029055|  36.23627|       0|
|seasonal7  | 139.11250|  4.029055|  34.52733|       0|
|seasonal8  | 138.41667|  4.029055|  34.35462|       0|
|seasonal9  | 130.56250|  4.029055|  32.40524|       0|
|seasonal10 | 134.09167|  4.029055|  33.28117|       0|
|seasonal11 | 111.83333|  4.029055|  27.75671|       0|
|seasonal12 |  92.15833|  4.029055|  22.87344|       0|

---
# Улиралын фактор

```{r echo=FALSE, message=FALSE,fig.fullwidth=TRUE, fig.align='center', fig.width = 11,fig.height=7}
bar <- barplot(res1$coefficients, names.arg = paste0("s", 1:12), border=FALSE)
text(bar, res1$coefficients , signif(res1$coefficients, 3) , cex=0.7)
```

---
```{r echo=FALSE, message=FALSE,fig.fullwidth=TRUE, fig.align='center', fig.width = 11,fig.height=7}
plot(hstarts ~ date, data =  estimation_data, 
      type = "l", 
      lwd = 2, 
      xlab = "Time", 
      ylab="Sales",
      main = "Housing Starts")
lines(estimation_data$date, fitted(res1), col="blue", lty=2,lwd=2)
legend("topright", c("Actual", "Fitted"), 
       lty = c(1, 2), 
       col = c("black", "blue"), cex=0.6)
```
---
# Forecasts
```{r echo=FALSE, message=FALSE,fig.fullwidth=TRUE, fig.align='center', fig.width = 11,fig.height=7}
plot_data <- ch6data %>% 
  select(date, hstarts, seasonal) %>% 
  filter(date >= as.Date("1990-01-01") & date <= as.Date("1994-11-01"))
plot(plot_data$date, plot_data$hstarts, 
     type = "l",
     xlab = "Time", 
     ylab="History, Forecasts, Realization",
     ylim = c(30, 210))
polygon(c(as.Date("1994-01-01") ,  as.Date("1994-01-01"), as.Date("1994-11-01"), as.Date("1994-11-01")), 
        c(30, 210,  210, 30), col = "grey85", border = NA)
lines(plot_data$date, plot_data$hstarts, lwd = 2) 
point_forecasts <- predict(res1, evaluation_data) 
# interval forecasts
lower <- point_forecasts - 1.96*summary(res1)$sigma
upper <- point_forecasts + 1.96*summary(res1)$sigma
lines(evaluation_data$date , point_forecasts, 
      type = "l", 
      col = "red", 
      lwd=2, 
      lty=2)
lines(evaluation_data$date , lower, 
      type = "l", 
      col = "red", 
      lty = 2)
lines(evaluation_data$date , upper, type = "l", col = "red", lty = 2)

```
