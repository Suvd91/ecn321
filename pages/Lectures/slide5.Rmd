---
title: "Эконометрикс II"
subtitle: "Лекц 6: Мөчлөгийг тодорхойлох<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>"
author: "багш: Д. Хашбаатар"
date: "2019/09/23"
output:
  xaringan::moon_reader:
    css: ['default', 'metropolis', 'metropolis-fonts', 'my-css.css']
    # self_contained: true
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{R, setup, include = F}
options(htmltools.dir.version = FALSE)
library(pacman)
p_load(
  broom, here, tidyverse,
  latex2exp, ggplot2, ggthemes, viridis, extrafont, gridExtra,
  kableExtra,
  dplyr,
  lubridate,
  magrittr, knitr, parallel
)
# Define pink color
red_pink <- "#e64173"
turquoise <- "#20B2AA"
grey_light <- "grey70"
grey_mid <- "grey50"
grey_dark <- "grey20"
# Dark slate grey: #314f4f
# Knitr options
opts_chunk$set(
  comment = "#>",
  fig.align = "center",
  fig.height = 7,
  fig.width = 10.5,
  warning = F,
  message = F
)
opts_chunk$set(dev = "svg")
options(device = function(file, width, height) {
  svg(tempfile(), width = width, height = height)
})
# A blank theme for ggplot
theme_empty <- theme_bw() + theme(
  line = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  plot.margin = structure(c(0, 0, -0.5, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_simple <- theme_bw() + theme(
  line = element_blank(),
  panel.grid = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text.x = element_text(size = 18, family = "STIXGeneral"),
  axis.text.y = element_blank(),
  axis.ticks = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  # plot.margin = structure(c(0, 0, -1, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_math <- theme_void() + theme(
  text = element_text(family = "MathJax_Math"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_serif <- theme_void() + theme(
  text = element_text(family = "MathJax_Main"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes <- theme_void() + theme(
  text = element_text(family = "Fira Sans Book"),
  axis.title = element_text(size = 18),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = grey_light,
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_set(theme_gray(base_size = 20))
```

```{R, colors, include = F}
# Define pink color
red_pink <- "#e64173"
turquoise <- "#20B2AA"
orange <- "#FFA500"
red <- "#fb6107"
blue <- "#2b59c3"
green <- "#8bb174"
grey_light <- "grey70"
grey_mid <- "grey50"
grey_dark <- "grey20"
purple <- "#6A5ACD"
```

# Мөчлөгийг загварчлах

.hi[Хугацаан цуваа]
$$y_t=Trend_t + {Seasonal}_t + \color{#e64173}{Ciclyc_t} + \varepsilon_t$$
>.small[.hi-pink[Мөчлөг]: Динамик хамаарал нь тогтвортой байх хугацаан цуваа.]


--

*Динамик хамаарал*: .hi-pink[Автокорреляц]

--

*Tогтвортой*: .hi-pink[стационарь]

---
# Нэршил, Тодорхойлолт
 
.hi-pink[realization (илэрц)]: 
 - Цаг хугацааны дагуу дугаарлагдсан цуваа $\{\ldots,y_{-1},y_0,y_1,\ldots\}$

.hi-pink[sample path (түүвэр)]: 
 - цувааны ажиглагдсан утгууд $y_1,\ldots,y_T$

.hi-pink[lag(хоцрол)]: 
 - Хугацаан цувааны өмнөх утгууд. $y_t$-ийн $j$-р хоцрол нь $y_{t-j}$. 

.hi-pink[difference]:
 - $\Delta y_t=y_t-y_{t-1}$
 

---
# Нэршил, Тодорхойлолт

.hi-pink[Дундаж]: $$\mathrm{E}(y_t)=\mu_t$$

.hi-pink[Автоковариацийн функц (Autocovariance)]: $$\gamma(t, h)=\mathrm{Cov}(y_t, y_{t-h})$$
--

 - Автоковариацийн функц $t$-с хамаарахгүй бол $\gamma(h)=\mathrm{Cov}(y_t, y_{t-h})$.
 
--
 
 - $\gamma(0)=\mathrm{Cov}(y_t, y_{t})=\mathrm{Var}(y_t)$

--

.hi-pink[Автокорреляцийн функц (Autocorrelation)]: $$\rho(h) \equiv \frac{\gamma(h)}{\gamma(0)}$$
 - $\rho(h)\neq 0$ бол автокорреляц хамааралтай цуваа

---
class: clear

.hi-slate[Эерэг автокорреляц хамаарал] 
```{R, positive auto u, echo = F, fig.height = 7.25}
# Number of observations
T <- 1e2
# Rho
rho <- 0.95
# Set seed and starting point
set.seed(1234)
start <- rnorm(1)
# Generate the data
ar_df <- tibble(
  t = 1:T,
  e = rnorm(T, mean = 0, sd = 2),
  u = NA
)
for (x in 1:T) {
  if (x == 1) {
    ar_df$u[x] <- rho * start + ar_df$e[x]
  } else {
    ar_df$u[x] <- rho * ar_df$u[x-1] + ar_df$e[x]
  }
}

# Plot disturbances over time
ggplot(data = ar_df,
  aes(t, u)
) +
geom_line(color = "grey85", size = 0.35) +
geom_point(color = red_pink, size = 2.25) +
ylab("y") +
xlab("t") +
# theme_pander(base_family = "Fira Sans Book", base_size = 20)
theme_axes_math
```
---
class: clear

.hi-slate[Сөрөг автокорреляц хамаарал]
```{R, negative auto u, echo = F, fig.height = 7.25}
# Number of observations
T <- 1e2
# Rho
rho <- -0.95
# Generate the data
ar_df$u1 <- NA
for (x in 1:T) {
  if (x == 1) {
    ar_df$u1[x] <- rho * start + ar_df$e[x]
  } else {
    ar_df$u1[x] <- rho * ar_df$u1[x-1] + ar_df$e[x]
  }
}
# Plot disturbances over time
ggplot(data = ar_df,
  aes(t, u1)
) +
geom_line(color = "grey85", size = 0.35) +
geom_point(color = red_pink, size = 2.25) +
ylab("y") +
xlab("t") +
# theme_pander(base_family = "Fira Sans Book", base_size = 20)
theme_axes_math
```

---
# Стационарь цуваа

> Хугацаан цувааны эхний 2 момент нь $t$-ээс үл хамаарах бол .hi[стационар цуваа (covariance stationary)] гэнэ. Өөрөөр хэлбэл дараах 2 нөхцлийг хангана.
 1. $$\mathrm{E}(y_t)=\mu$$
 2. $$\gamma(h)=\mathrm{Cov}(y_t, y_{t-h})<\infty$$

---
# White noise

 - Дундаж нь 0 байх, авкорреляц хамааралгүй хугацаан цувааг .hi-pink[white noise] (.small[цагаан шуугиан]) гэдэг.

 - $\varepsilon_t\sim WN(0,\sigma^2)$

  - $\mathrm{E}(\varepsilon_t)=0$
  - $\mathrm{Var}(\varepsilon_t)=\sigma^2$
  - $\rho(h)=0,\quad h>1$
  
--

Нөхцөлт дундаж болон вариацын хувьд ( $\Omega_t=\{\varepsilon_t,\varepsilon_{t-1},\ldots \}$)

 - $\mathrm{E}(\varepsilon_t|\Omega_{t−1})=0$
 - $\mathrm{Var}(\varepsilon_t|\Omega_{t−1} )=\mathrm{E}\{(\varepsilon_t−\mathrm{E}(\varepsilon_t|\Omega_{t−1}))^2|\Omega_{t−1}\}=\sigma^2$

---
class: clear
.hi-slate[Realization of White Noise]
```{R, wn, echo = F, fig.height = 7.25}
# Plot disturbances over time
ggplot(data = ar_df, aes(t, e)) +
  geom_line(color = "grey85", size = 0.35) +
  geom_point(color = red_pink, size = 2.25) +
  ylab("e") +
  xlab("t") +
  # theme_pander(base_family = "Fira Sans Book", base_size = 20)
  theme_axes_math
```

---
# Wold theorem, General Linear Process

---
# Ухраах оператор Lag operator
$$L(y_t)=y_{t-1},\quad L(L(y_t))=L^2(y_t)=y_{t-2}, \quad L^m(y_t)=y_{t-m}$$


## Ухраах операторын олон гишүүнт

$$B(L)=b_0+b_1L+b_2L^2+\cdots+b_mL^m$$


$$B(L)=b_0+b_1L+b_2L^2+\cdots+\cdots=\sum_{t=1}^\infty b_iL^i$$

$$B(L)\varepsilon_t=b_0\varepsilon_t+b_1\varepsilon_{t-1}+b_2\varepsilon_{t-2}+\cdots=\sum_{t=1}^\infty b_i\varepsilon_{t-i}$$

---
# Корреляцийн түүвэр дэх үнэлгээ
---
# Application: 
.hi[Characterizing Canadian Employment Dynamics]
